<!doctype html>
<html>
<head>
  <title>Fan Control</title>
  <style>
    body { font-family: sans-serif; padding: 40px; }
    input { width: 300px; }
  </style>
</head>
<body>

<h1>Blade PC Fan Control</h1>

<p><a href="http://192.168.50.83:5000/" target="_blank" rel="noopener">NAS Monitor</a></p>

<form method="POST">
  <input id="speedRange" type="range" min="0" max="100" name="speed" value="50">
  <output id="speedOutput">50</output>%
  <br><br>
  <button type="submit">Set Speed</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const slider = document.getElementById('speedRange');
  const output = document.getElementById('speedOutput');

  const stored = localStorage.getItem('fan_speed');
  // Server-provided last speed (null or number)
  const serverSpeed = {{ last_speed | tojson }};

  if (stored !== null) {
    slider.value = stored;
    output.textContent = stored;
  } else if (serverSpeed !== null) {
    slider.value = serverSpeed;
    output.textContent = serverSpeed;
    localStorage.setItem('fan_speed', serverSpeed);
  } else {
    output.textContent = slider.value;
  }

  slider.addEventListener('input', function () {
    output.textContent = this.value;
    localStorage.setItem('fan_speed', this.value);
  });

  // Ensure value is saved on submit as well
  document.querySelector('form').addEventListener('submit', function () {
    localStorage.setItem('fan_speed', slider.value);
  });
});
</script>

</body>
</html>
